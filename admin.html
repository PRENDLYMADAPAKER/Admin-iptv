<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IPTV Admin Panel</title>
  <style>
    body {
      background: url('https://i.ibb.co/BqgjBpH/anony-bg.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 0;
    }
    .panel {
      background: rgba(0, 0, 0, 0.85);
      padding: 20px;
      border-radius: 12px;
      max-width: 500px;
      margin: 60px auto;
    }
    h1 {
      text-align: center;
      color: #ff0077;
    }
    table {
      width: 100%;
      margin-top: 15px;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th {
      color: #ff0077;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
    }
    button {
      background: #ff0077;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="panel">
    <h1>🔥 IPTV Admin Panel 🔥</h1>
    <div>
      <h3>Real-time Users</h3>
      <table border="1">
        <thead>
          <tr>
            <th>Email</th>
            <th>UID</th>
            <th>Force Logout</th>
          </tr>
        </thead>
        <tbody id="userTable">
          <tr><td colspan="3">Loading users...</td></tr>
        </tbody>
      </table>
    </div>

    <hr style="margin:20px 0; border-color:#555;">

    <div>
      <h3>Add New IPTV User</h3>
      <input type="email" id="newEmail" placeholder="Email">
      <input type="password" id="newPassword" placeholder="Password">
      <button onclick="createAccount()">Create Account</button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase config (from your screenshot)
    const firebaseConfig = {
      apiKey: "AIzaSyA0TjMoFSYBIs0VQ9shUilOuDGb1uXHjKI",
      authDomain: "iptv-log-in.firebaseapp.com",
      databaseURL: "https://iptv-log-in-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iptv-log-in",
      storageBucket: "iptv-log-in.appspot.com",
      messagingSenderId: "820026131349",
      appId: "1:820026131349:web:417abd6ad9057c55a92c9c",
      measurementId: "G-4Y8T6J595Z"
    };

    // Init Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Load user list
    async function loadUsers() {
      const result = await fetch("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=" + firebaseConfig.apiKey, {
        method: "POST",
        body: JSON.stringify({
          email: "admin@nzmiptv.com",
          password: "admin123",
          returnSecureToken: true
        }),
        headers: {
          "Content-Type": "application/json"
        }
      });
      const tokenData = await result.json();

      if (tokenData.idToken) {
        const userTable = document.getElementById("userTable");
        userTable.innerHTML = "";

        const listRes = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${firebaseConfig.apiKey}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idToken: tokenData.idToken })
        });

        const userList = await listRes.json();

        db.ref("sessions").once("value", snapshot => {
          const sessions = snapshot.val() || {};

          userList.users.forEach(user => {
            const uid = user.localId;
            const email = user.email || "N/A";
            const row = document.createElement("tr");

            const forceLogout = () => {
              const userSessions = sessions[uid] || {};
              const keys = Object.keys(userSessions);
              keys.forEach(deviceId => {
                db.ref(`sessions/${uid}/${deviceId}`).remove();
              });
              alert(`✅ All sessions for ${email} have been force logged out.`);
            };

            row.innerHTML = `
              <td>${email}</td>
              <td>${uid}</td>
              <td><button onclick="(${forceLogout.toString()})()">Force Logout</button></td>
            `;
            userTable.appendChild(row);
          });
        });
      } else {
        alert("❌ Failed to authenticate admin.");
      }
    }

    // Create new user
    function createAccount() {
      const email = document.getElementById("newEmail").value;
      const password = document.getElementById("newPassword").value;

      if (!email || !password) return alert("Fill in both fields.");
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          alert("✅ User created!");
          document.getElementById("newEmail").value = "";
          document.getElementById("newPassword").value = "";
          loadUsers();
        })
        .catch(err => alert("❌ " + err.message));
    }

    // Auto load
    window.onload = () => {
      loadUsers();
    };
  </script>
</body>
</html>
