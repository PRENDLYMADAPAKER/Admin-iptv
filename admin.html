<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NZM Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-functions-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('https://i.imgur.com/yeftKeD.jpeg') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    .glass {
      background: rgba(0, 0, 0, 0.65);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      margin: 20px auto;
      width: 95%;
      max-width: 900px;
      box-shadow: 0 0 20px #000;
    }
    h2, h3 {
      margin-top: 0;
      color: #ff007f;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 8px;
      width: 100%;
    }
    input {
      background: #222;
      color: white;
    }
    button {
      background: #ff007f;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .user-box {
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.05);
    }
    .user-box span {
      display: block;
      margin-bottom: 5px;
    }
    .actions button {
      margin-right: 10px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="glass">
    <h2>üëë NZM IPTV Admin Panel</h2>
    <div id="authSection">
      <h3>Login</h3>
      <input type="email" id="adminEmail" placeholder="Admin Email" />
      <input type="password" id="adminPass" placeholder="Password" />
      <button onclick="adminLogin()">Login</button>
      <p id="loginError" style="color: red;"></p>
    </div>

    <div id="dashboard" style="display: none;">
      <h3>Create New IPTV Account</h3>
      <input type="email" id="newEmail" placeholder="New Email" />
      <input type="password" id="newPassword" placeholder="Password" />
      <button onclick="createUser()">Create Account</button>
      <p id="createStatus" style="color: lightgreen;"></p>

      <h3>All Users</h3>
      <div id="userList"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA0TjMoFSYBIs0VQ9shUilOuDGb1uXHjKI",
      authDomain: "iptv-log-in.firebaseapp.com",
      databaseURL: "https://iptv-log-in-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iptv-log-in",
      storageBucket: "iptv-log-in.appspot.com",
      messagingSenderId: "820026131349",
      appId: "1:820026131349:web:417abd6ad9057c55a92c9c"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();
    const functions = firebase.app().functions('asia-southeast1');

    const authSection = document.getElementById('authSection');
    const dashboard = document.getElementById('dashboard');
    const userList = document.getElementById('userList');

    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const pass = document.getElementById('adminPass').value;
      auth.signInWithEmailAndPassword(email, pass)
        .then(() => {
          authSection.style.display = 'none';
          dashboard.style.display = 'block';
          fetchUsers();
        })
        .catch(e => {
          document.getElementById('loginError').textContent = e.message;
        });
    }

    function createUser() {
      const email = document.getElementById('newEmail').value;
      const pass = document.getElementById('newPassword').value;
      functions.httpsCallable('createUser')({ email, password: pass })
        .then(res => {
          document.getElementById('createStatus').textContent = `Created UID: ${res.data.uid}`;
          fetchUsers();
        })
        .catch(e => {
          document.getElementById('createStatus').textContent = e.message;
        });
    }

    function fetchUsers() {
      userList.innerHTML = 'Loading...';
      functions.httpsCallable('listUsers')()
        .then(res => {
          userList.innerHTML = '';
          res.data.forEach(user => {
            const div = document.createElement('div');
            div.className = 'user-box';
            div.innerHTML = `
              <span><strong>Email:</strong> ${user.email}</span>
              <span><strong>UID:</strong> ${user.uid}</span>
              <span><strong>Status:</strong> ${user.disabled ? 'üîí Banned' : '‚úÖ Active'}</span>
              <div class="actions">
                <button onclick="banUser('${user.uid}')">üö´ Ban</button>
                <button onclick="unbanUser('${user.uid}')">‚úÖ Unban</button>
              </div>
              <div>
                <h4>Devices:</h4>
                <div id="sessions-${user.uid}">Loading...</div>
              </div>
            `;
            userList.appendChild(div);
            loadSessions(user.uid);
          });
        });
    }

    function banUser(uid) {
      functions.httpsCallable('disableUser')({ uid }).then(fetchUsers);
    }

    function unbanUser(uid) {
      functions.httpsCallable('enableUser')({ uid }).then(fetchUsers);
    }

    function loadSessions(uid) {
      const ref = db.ref(`sessions/${uid}`);
      const target = document.getElementById(`sessions-${uid}`);
      ref.on('value', snap => {
        const data = snap.val();
        if (!data) return target.innerHTML = '<em>No active sessions</em>';
        target.innerHTML = '';
        Object.keys(data).forEach(deviceId => {
          const div = document.createElement('div');
          div.innerHTML = `
            üì± ${deviceId}
            <button onclick="forceLogout('${uid}', '${deviceId}')">‚ùå Logout</button>
          `;
          target.appendChild(div);
        });
      });
    }

    function forceLogout(uid, deviceId) {
      functions.httpsCallable('forceLogout')({ uid, deviceId })
        .then(() => alert('Device has been logged out.'))
        .catch(e => alert('Error: ' + e.message));
    }
  </script>
</body>
</html>
