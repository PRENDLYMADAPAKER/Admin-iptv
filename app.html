<!-- app.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IPTV Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: white;
    }
    header {
      background: #1f1f1f;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
    }
    #logo {
      font-size: 1.4em;
      color: #ff5722;
      font-weight: bold;
    }
    #clock {
      font-size: 1em;
    }
    #video-player {
      width: 100%;
      height: 220px;
      background: black;
    }
    #now-section {
      display: flex;
      align-items: center;
      background: #222;
      padding: 10px;
    }
    #channel-icon {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      border-radius: 6px;
    }
    #now-playing {
      font-size: 1.2em;
    }
    #epg-now {
      font-size: 0.9em;
      color: #aaa;
    }
    #controls {
      display: flex;
      gap: 10px;
      padding: 10px;
    }
    input, select {
      padding: 8px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      width: 100%;
      max-width: 180px;
    }
    #channel-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 10px;
    }
    .channel-card {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 0 4px rgba(255, 255, 255, 0.1);
    }
    .channel-card img {
      width: 100%;
      height: 100px;
      object-fit: contain;
      border-radius: 6px;
      background: #000;
    }
    .channel-card span {
      display: block;
      margin: 5px 0;
      font-size: 0.95em;
    }
    .channel-card button {
      background: none;
      border: none;
      color: #ff0;
      font-size: 1.4em;
    }
    #settings-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ff5722;
      border: none;
      padding: 12px 16px;
      border-radius: 50%;
      font-size: 20px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <div id="logo">IPTV Premium</div>
    <div id="clock">--:--</div>
  </header>

  <video id="video-player" controls autoplay></video>

  <div id="now-section">
    <img id="channel-icon" src="" alt="Logo">
    <div>
      <div id="now-playing">Now Playing</div>
      <div id="epg-now">Loading EPG...</div>
    </div>
  </div>

  <div id="controls">
    <input type="text" id="search" placeholder="Search channels...">
    <select id="category-filter">
      <option value="all">All Categories</option>
      <option value="favorites">Favorites</option>
    </select>
    <input type="text" id="custom-m3u" placeholder="Paste M3U URL" />
    <button onclick="importM3U()">Import</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="channel-grid"></div>

  <button id="settings-btn" onclick="refreshAll()">‚ü≥</button>

  <script src="iptv-core.js"></script>
  <script>
    // Live Clock
    setInterval(() => {
      const now = new Date();
      document.getElementById("clock").textContent =
        now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }, 1000);

    // Search & Category Filter
    document.getElementById("search").addEventListener("input", renderChannels);
    document.getElementById("category-filter").addEventListener("change", renderChannels);

    // Swipe Navigation
    let startX = 0;
    document.getElementById("channel-grid").addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
    });
    document.getElementById("channel-grid").addEventListener("touchend", e => {
      const endX = e.changedTouches[0].clientX;
      if (endX < startX - 50) {
        currentIndex = Math.min(currentIndex + 2, channels.length - 2);
        renderChannels();
      } else if (endX > startX + 50) {
        currentIndex = Math.max(currentIndex - 2, 0);
        renderChannels();
      }
    });

    // Custom M3U Import
    function importM3U() {
      const url = document.getElementById("custom-m3u").value.trim();
      if (url) {
        localStorage.setItem("customM3U", url);
        location.reload();
      }
    }

    // Logout (Firebase)
    function logout() {
      if (firebase && firebase.auth) {
        firebase.auth().signOut().then(() => {
          location.href = "index.html";
        });
      } else {
        location.href = "index.html";
      }
    }

    // Refresh button
    function refreshAll() {
      location.reload();
    }
  </script>

  <!-- Firebase (optional if logout used) -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA0TjMoFSYBIs0VQ9shUilOuDGb1uXHjKI",
      authDomain: "iptv-log-in.firebaseapp.com",
      projectId: "iptv-log-in",
      appId: "1:820026131349:web:417abd6ad9057c55a92c9c"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

</body>
</html>
