<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
    }
    header {
      background-color: #1c1c1c;
      padding: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header img {
      height: 40px;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    video {
      width: 100%;
      max-height: 240px;
      background-color: #000;
    }
    .now-playing {
      padding: 10px;
      background-color: #1f1f1f;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .now-playing img {
      height: 30px;
      width: 30px;
    }
    .controls {
      padding: 10px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .channels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      transition: transform 0.3s ease-in-out;
    }
    .channel {
      width: 45%;
      background-color: #292929;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      position: relative;
    }
    .channel img {
      width: 100%;
      border-radius: 10px;
    }
    .channel .fav {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      color: white;
      font-size: 16px;
    }
    @media(min-width: 768px){
      .channel {
        width: 200px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="IPTV Premium" />
    <h1>IPTV PREMIUM</h1>
  </header>

  <video id="player" controls autoplay></video>

  <div class="now-playing">
    <img id="channel-icon" src="" alt="icon" />
    <div>
      <strong id="channel-name">Now Playing:</strong><br>
      <small id="epg">EPG unavailable</small>
    </div>
  </div>

  <div class="controls">
    <select id="category-filter"></select>
    <input type="text" id="search" placeholder="Search channels...">
  </div>

  <div id="channel-list" class="channels"></div>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u";
    let channels = [], favorites = [], filtered = [];
    let currentIndex = 0;

    function parseM3U(data) {
      const lines = data.split('\n');
      let group = '', logo = '', name = '', url = '';
      for (let line of lines) {
        if (line.startsWith('#EXTINF')) {
          const info = line.match(/tvg-logo="(.*?)".*group-title="(.*?)".*,(.*)/);
          if (info) {
            logo = info[1];
            group = info[2];
            name = info[3];
          }
        } else if (line.startsWith('http')) {
          url = line.trim();
          channels.push({ name, logo, group, url });
        }
      }
      favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    }

    function updateUI() {
      const list = document.getElementById('channel-list');
      list.innerHTML = '';
      filtered.slice(currentIndex, currentIndex + 2).forEach((ch, idx) => {
        const div = document.createElement('div');
        div.className = 'channel';
        div.innerHTML = `
          <img src="${ch.logo}" alt="logo" onclick="playChannel(${channels.indexOf(ch)})"/>
          <div>${ch.name}</div>
          <button class="fav" onclick="toggleFavorite(${channels.indexOf(ch)})">${favorites.includes(ch.name) ? '★' : '☆'}</button>
        `;
        list.appendChild(div);
      });
    }

    function playChannel(index) {
      const ch = channels[index];
      document.getElementById('player').src = ch.url;
      document.getElementById('channel-name').innerText = `Now Playing: ${ch.name}`;
      document.getElementById('channel-icon').src = ch.logo;
    }

    function toggleFavorite(index) {
      const name = channels[index].name;
      if (favorites.includes(name)) {
        favorites = favorites.filter(n => n !== name);
      } else {
        favorites.push(name);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      applyFilters();
    }

    function applyFilters() {
      const cat = document.getElementById('category-filter').value;
      const keyword = document.getElementById('search').value.toLowerCase();
      filtered = channels.filter(c => 
        (cat === 'All' || c.group === cat || (cat === 'Favorite' && favorites.includes(c.name))) &&
        c.name.toLowerCase().includes(keyword)
      );
      currentIndex = 0;
      updateUI();
    }

    document.getElementById('search').addEventListener('input', applyFilters);

    document.addEventListener('touchstart', handleTouchStart, false);
    document.addEventListener('touchmove', handleTouchMove, false);
    let xDown = null;

    function handleTouchStart(evt) {
      xDown = evt.touches[0].clientX;
    }
    function handleTouchMove(evt) {
      if (!xDown) return;
      let xUp = evt.touches[0].clientX;
      let xDiff = xDown - xUp;
      if (xDiff > 50 && currentIndex + 2 < filtered.length) currentIndex += 2;
      if (xDiff < -50 && currentIndex - 2 >= 0) currentIndex -= 2;
      updateUI();
      xDown = null;
    }

    fetch(m3uUrl)
      .then(res => res.text())
      .then(data => {
        parseM3U(data);
        const cats = [...new Set(channels.map(c => c.group))];
        const select = document.getElementById('category-filter');
        select.innerHTML = `<option>All</option><option>Favorite</option>` + cats.map(c => `<option>${c}</option>`).join('');
        select.addEventListener('change', applyFilters);
        filtered = channels;
        updateUI();
      });
  </script>
</body>
</html>
