<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      overflow-x: hidden;
    }
    header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #1e1e1e;
    }
    header img {
      width: 40px;
      height: 40px;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    #videoPlayer {
      width: 100%;
      height: 240px;
      background: black;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
    }
    .channel-list {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 10px;
    }
    .channel {
      flex: 0 0 auto;
      width: 160px;
      background: #222;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
    }
    .channel img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      border-radius: 6px;
    }
    .channel h4 {
      margin: 5px 0 0;
      font-size: 14px;
    }
    .banner {
      background: #1e1e1e;
      padding: 10px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .banner img {
      width: 30px;
      height: 30px;
    }
    .dark-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" />
    <h1>IPTV Premium</h1>
    <button class="dark-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
  </header>

  <video id="videoPlayer" controls autoplay></video>

  <div class="banner">
    <img id="nowIcon" src="" alt="icon" />
    <span id="nowPlaying">Now Playing: None</span>
    <button onclick="togglePiP()">ðŸ“º PiP</button>
    <button onclick="alert('Chromecast SDK not integrated yet.')">ðŸ“¡ Cast</button>
  </div>

  <div class="channel-list" id="channelList"></div>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u";
    const player = document.getElementById("videoPlayer");
    const channelList = document.getElementById("channelList");
    const nowPlaying = document.getElementById("nowPlaying");
    const nowIcon = document.getElementById("nowIcon");

    async function loadChannels() {
      const res = await fetch(m3uUrl);
      const text = await res.text();
      const lines = text.split("\n");
      const channels = [];
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith("#EXTINF")) {
          const nameMatch = lines[i].match(/tvg-name="(.*?)"/);
          const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
          const title = nameMatch ? nameMatch[1] : "Unknown";
          const logo = logoMatch ? logoMatch[1] : "logo.png";
          const url = lines[i + 1];
          channels.push({ title, logo, url });
        }
      }

      channels.forEach((ch, i) => {
        const div = document.createElement("div");
        div.className = "channel";
        div.innerHTML = `<img src="${ch.logo}" /><h4>${ch.title}</h4>`;
        div.onclick = () => playChannel(ch);
        channelList.appendChild(div);
      });

      if (channels.length > 0) playChannel(channels[0]);
    }

    function playChannel(channel) {
      player.src = channel.url;
      nowPlaying.innerText = `Now Playing: ${channel.title}`;
      nowIcon.src = channel.logo;
      localStorage.setItem("lastChannel", JSON.stringify(channel));
    }

    function togglePiP() {
      if (document.pictureInPictureElement) {
        document.exitPictureInPicture();
      } else {
        player.requestPictureInPicture();
      }
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
      localStorage.setItem("theme", document.body.classList.contains("light") ? "light" : "dark");
    }

    function applySavedTheme() {
      const saved = localStorage.getItem("theme");
      if (saved === "light") document.body.classList.add("light");
    }

    function resumeLastChannel() {
      const saved = localStorage.getItem("lastChannel");
      if (saved) {
        const channel = JSON.parse(saved);
        playChannel(channel);
      }
    }

    applySavedTheme();
    loadChannels().then(resumeLastChannel);
  </script>
</body>
</html>
