<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #121212;
      color: #fff;
    }
    header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background-color: #1f1f1f;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header img {
      height: 40px;
    }
    .now-playing {
      padding: 5px 10px;
      background: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .now-playing img {
      height: 25px;
      width: 25px;
      object-fit: contain;
    }
    .player-container {
      position: sticky;
      top: 60px;
      background: black;
    }
    video {
      width: 100%;
      max-height: 300px;
      background: black;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      padding: 10px;
    }
    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      padding: 10px;
    }
    .categories button {
      padding: 5px 10px;
      background: #333;
      border: none;
      color: #fff;
      cursor: pointer;
    }
    .channel-list {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      gap: 10px;
      padding: 10px;
    }
    .channel-card {
      flex: 0 0 auto;
      width: 150px;
      background: #222;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      scroll-snap-align: start;
      cursor: pointer;
    }
    .channel-card img {
      width: 100%;
      height: 80px;
      object-fit: contain;
      margin-bottom: 5px;
    }
    .dark-mode-toggle {
      cursor: pointer;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" />
    <h1>IPTV Premium</h1>
    <div style="margin-left:auto">
      <span class="dark-mode-toggle">üåô</span>
    </div>
  </header>
  <div class="now-playing" id="nowPlaying">
    <img id="nowLogo" src="" alt="icon" />
    <span id="nowTitle">Now Playing</span>
  </div>
  <div class="player-container">
    <video id="video" controls autoplay></video>
  </div>
  <div class="controls">
    <input type="text" id="search" placeholder="Search..." />
  </div>
  <div class="categories" id="categoryButtons"></div>
  <div class="channel-list" id="channelList"></div>

  <script>
    const video = document.getElementById("video");
    const nowTitle = document.getElementById("nowTitle");
    const nowLogo = document.getElementById("nowLogo");
    const channelList = document.getElementById("channelList");
    const categoryButtons = document.getElementById("categoryButtons");
    const searchInput = document.getElementById("search");
    const darkModeToggle = document.querySelector(".dark-mode-toggle");

    let channels = [];
    let currentChannelIndex = 0;
    let currentCategory = "All";

    function fetchM3U() {
      fetch("https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u")
        .then(res => res.text())
        .then(parseM3U);
    }

    function parseM3U(data) {
      const lines = data.split("\n");
      let categorySet = new Set(["All"]);

      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith("#EXTINF")) {
          const info = lines[i];
          const url = lines[i + 1];
          const nameMatch = info.match(/,(.*)$/);
          const logoMatch = info.match(/tvg-logo="(.*?)"/);
          const groupMatch = info.match(/group-title="(.*?)"/);

          const name = nameMatch ? nameMatch[1] : "Unknown";
          const logo = logoMatch ? logoMatch[1] : "";
          const group = groupMatch ? groupMatch[1] : "Others";

          categorySet.add(group);

          channels.push({ name, logo, group, url });
        }
      }
      renderCategories(Array.from(categorySet));
      renderChannels();
    }

    function renderCategories(categories) {
      categoryButtons.innerHTML = "";
      categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.onclick = () => {
          currentCategory = cat;
          renderChannels();
        };
        categoryButtons.appendChild(btn);
      });
    }

    function renderChannels() {
      const filtered = channels.filter(c =>
        (currentCategory === "All" || c.group === currentCategory) &&
        c.name.toLowerCase().includes(searchInput.value.toLowerCase())
      );
      channelList.innerHTML = "";
      filtered.forEach((ch, index) => {
        const card = document.createElement("div");
        card.className = "channel-card";
        card.innerHTML = `<img src="${ch.logo}" alt="logo" /><div>${ch.name}</div>`;
        card.onclick = () => playChannel(index);
        channelList.appendChild(card);
      });
    }

    function playChannel(index) {
      const ch = channels[index];
      video.src = ch.url;
      nowTitle.textContent = ch.name;
      nowLogo.src = ch.logo;
      currentChannelIndex = index;
      localStorage.setItem("lastChannel", index);
    }

    function restoreLastChannel() {
      const index = localStorage.getItem("lastChannel");
      if (index && channels[index]) {
        playChannel(Number(index));
      }
    }

    searchInput.addEventListener("input", renderChannels);

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") {
        currentChannelIndex = (currentChannelIndex + 1) % channels.length;
        playChannel(currentChannelIndex);
      } else if (e.key === "ArrowLeft") {
        currentChannelIndex = (currentChannelIndex - 1 + channels.length) % channels.length;
        playChannel(currentChannelIndex);
      }
    });

    darkModeToggle.onclick = () => {
      document.body.classList.toggle("light");
      darkModeToggle.textContent = document.body.classList.contains("light") ? "‚òÄÔ∏è" : "üåô";
    };

    fetchM3U();
    setTimeout(restoreLastChannel, 2000);
  </script>
</body>
</html>
