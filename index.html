<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
    }
    header {
      display: flex;
      align-items: center;
      background: #1e1e1e;
      padding: 10px;
    }
    header img {
      height: 40px;
      margin-right: 10px;
    }
    #video-container {
      position: sticky;
      top: 0;
      z-index: 100;
      background: black;
    }
    video {
      width: 100%;
      max-height: 300px;
    }
    #channel-list {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
      gap: 10px;
    }
    .channel {
      background: #1f1f1f;
      padding: 10px;
      border-radius: 10px;
      width: 140px;
      cursor: pointer;
      text-align: center;
    }
    .channel img {
      width: 100%;
      height: 80px;
      object-fit: contain;
    }
    .controls {
      display: flex;
      gap: 10px;
      padding: 10px;
      justify-content: space-between;
      background: #1a1a1a;
      flex-wrap: wrap;
    }
    .controls input, .controls select {
      padding: 5px;
      border-radius: 5px;
      border: none;
    }
    .theme-toggle, .chromecast-btn {
      cursor: pointer;
      color: white;
      background: #444;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>IPTV Premium</h1>
  </header>
  <div id="video-container">
    <video id="videoPlayer" controls autoplay></video>
  </div>
  <div class="controls">
    <input type="text" id="searchBar" placeholder="Search channels..." />
    <select id="categoryFilter"></select>
    <select id="sortOptions">
      <option value="name">Sort by Name</option>
      <option value="favorites">Sort by Favorites</option>
      <option value="history">Sort by Most Watched</option>
    </select>
    <button class="theme-toggle">ðŸŒ“ Toggle Theme</button>
    <button class="chromecast-btn">ðŸ“º Cast</button>
  </div>
  <div id="channel-list"></div>  <script>
    const m3uURL = "https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u";
    const video = document.getElementById('videoPlayer');
    const channelList = document.getElementById('channel-list');
    const categoryFilter = document.getElementById('categoryFilter');
    const searchBar = document.getElementById('searchBar');
    const sortOptions = document.getElementById('sortOptions');
    let allChannels = [];

    function parseM3U(data) {
      const lines = data.split("\n");
      const channels = [];
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith("#EXTINF")) {
          const info = lines[i];
          const url = lines[i + 1];
          const nameMatch = info.match(/,(.*)$/);
          const logoMatch = info.match(/tvg-logo="(.*?)"/);
          const groupMatch = info.match(/group-title="(.*?)"/);
          channels.push({
            name: nameMatch ? nameMatch[1] : url,
            url,
            logo: logoMatch ? logoMatch[1] : '',
            group: groupMatch ? groupMatch[1] : 'Others',
          });
        }
      }
      return channels;
    }

    function renderChannels(channels) {
      channelList.innerHTML = '';
      const selectedGroup = categoryFilter.value;
      const search = searchBar.value.toLowerCase();
      const sorted = [...channels].sort((a, b) => {
        if (sortOptions.value === 'name') return a.name.localeCompare(b.name);
        return 0; // Add more sorting logic
      });
      for (const ch of sorted) {
        if ((selectedGroup === '' || ch.group === selectedGroup) && ch.name.toLowerCase().includes(search)) {
          const div = document.createElement('div');
          div.className = 'channel';
          div.innerHTML = `
            <img src="${ch.logo}" alt="${ch.name}" onerror="this.src='https://via.placeholder.com/140x80'" />
            <p>${ch.name}</p>
          `;
          div.onclick = () => {
            video.src = ch.url;
            video.play();
            localStorage.setItem('lastPlayed', ch.url);
          }
          channelList.appendChild(div);
        }
      }
    }

    async function loadM3U() {
      const res = await fetch(m3uURL);
      const text = await res.text();
      allChannels = parseM3U(text);

      const groups = [...new Set(allChannels.map(c => c.group))];
      categoryFilter.innerHTML = '<option value="">All Categories</option>' + groups.map(g => `<option value="${g}">${g}</option>`).join('');

      const last = localStorage.getItem('lastPlayed');
      if (last) video.src = last;

      renderChannels(allChannels);
    }

    // Event listeners
    searchBar.oninput = () => renderChannels(allChannels);
    categoryFilter.onchange = () => renderChannels(allChannels);
    sortOptions.onchange = () => renderChannels(allChannels);

    document.querySelector('.theme-toggle').onclick = () => {
      document.body.classList.toggle('light');
    };

    document.querySelector('.chromecast-btn').onclick = () => {
      alert("Chromecast placeholder â€“ integrate SDK");
    };

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        const idx = allChannels.findIndex(c => c.url === video.src);
        const next = (idx + 1) % allChannels.length;
        video.src = allChannels[next].url;
        video.play();
      } else if (e.key === 'ArrowLeft') {
        const idx = allChannels.findIndex(c => c.url === video.src);
        const prev = (idx - 1 + allChannels.length) % allChannels.length;
        video.src = allChannels[prev].url;
        video.play();
      }
    });

    video.addEventListener('enterpictureinpicture', () => console.log('PiP started'));
    video.addEventListener('leavepictureinpicture', () => console.log('PiP closed'));

    window.onload = loadM3U;
  </script></body>
</html>
