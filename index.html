<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
    }
    header {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #1f1f1f;
    }
    header img {
      height: 40px;
      margin-right: 10px;
    }
    header h1 {
      font-size: 1.5rem;
    }
    #controls {
      display: flex;
      gap: 10px;
      padding: 10px;
      background: #1a1a1a;
    }
    #categorySelect, #searchInput {
      padding: 5px;
      font-size: 1rem;
    }
    .channel-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding: 10px;
    }
    .channel-card {
      background: #222;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
    }
    .channel-card img {
      width: 100%;
      max-height: 80px;
      object-fit: contain;
    }
    .now-playing-banner {
      position: sticky;
      top: 0;
      background: #000;
      padding: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 999;
    }
    .now-playing-banner img {
      height: 24px;
    }
    video {
      width: 100%;
      max-height: 300px;
      position: sticky;
      top: 50px;
      z-index: 998;
    }
    #themeToggle {
      position: absolute;
      right: 10px;
      top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" />
    <h1>IPTV Premium</h1>
    <button id="themeToggle">ðŸŒ“</button>
  </header>  <div id="controls">
    <input type="text" id="searchInput" placeholder="Search channels..." />
    <select id="categorySelect"></select>
  </div>  <div class="now-playing-banner" id="nowPlaying" style="display:none">
    <img id="nowPlayingIcon" src="" alt="Channel Icon" />
    <span id="nowPlayingTitle"></span>
  </div><video id="videoPlayer" controls autoplay></video>

  <div class="channel-list" id="channelList"></div>  <script>
    const videoPlayer = document.getElementById('videoPlayer');
    const nowPlaying = document.getElementById('nowPlaying');
    const nowPlayingIcon = document.getElementById('nowPlayingIcon');
    const nowPlayingTitle = document.getElementById('nowPlayingTitle');
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');
    const themeToggle = document.getElementById('themeToggle');
    let channels = [];
    let currentCategory = 'All';

    async function fetchM3U() {
      const res = await fetch("https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u");
      const text = await res.text();
      parseM3U(text);
    }

    function parseM3U(data) {
      const lines = data.split("\n");
      let current = {};
      channels = [];
      const categories = new Set();
      for (let line of lines) {
        if (line.startsWith("#EXTINF")) {
          const nameMatch = line.match(/,(.*)$/);
          const logoMatch = line.match(/tvg-logo="(.*?)"/);
          const groupMatch = line.match(/group-title="(.*?)"/);
          current = {
            name: nameMatch ? nameMatch[1] : "Unknown",
            logo: logoMatch ? logoMatch[1] : "",
            category: groupMatch ? groupMatch[1] : "Uncategorized"
          };
          categories.add(current.category);
        } else if (line.startsWith("http")) {
          current.url = line.trim();
          channels.push(current);
        }
      }
      populateCategories(Array.from(categories));
      renderChannels();
    }

    function populateCategories(cats) {
      categorySelect.innerHTML = '<option value="All">All</option>';
      cats.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        categorySelect.appendChild(opt);
      });
    }

    function renderChannels() {
      const list = document.getElementById('channelList');
      list.innerHTML = '';
      const filtered = channels.filter(c =>
        (currentCategory === 'All' || c.category === currentCategory) &&
        c.name.toLowerCase().includes(searchInput.value.toLowerCase())
      );
      filtered.forEach(c => {
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.innerHTML = `<img src="${c.logo}" onerror="this.src='default-logo.png'"/><br>${c.name}`;
        card.onclick = () => playChannel(c);
        list.appendChild(card);
      });
    }

    function playChannel(channel) {
      videoPlayer.src = channel.url;
      nowPlaying.style.display = 'flex';
      nowPlayingIcon.src = channel.logo;
      nowPlayingTitle.textContent = channel.name;
      localStorage.setItem('lastChannel', JSON.stringify(channel));
    }

    categorySelect.onchange = e => {
      currentCategory = e.target.value;
      renderChannels();
    };
    searchInput.oninput = renderChannels;

    // Theme toggle
    themeToggle.onclick = () => {
      document.body.classList.toggle('light');
    };

    // Resume last channel
    const saved = localStorage.getItem('lastChannel');
    if (saved) playChannel(JSON.parse(saved));

    // Swipe support
    let startX = 0;
    window.addEventListener('touchstart', e => startX = e.touches[0].clientX);
    window.addEventListener('touchend', e => {
      const diff = e.changedTouches[0].clientX - startX;
      if (Math.abs(diff) > 50) {
        const index = channels.findIndex(c => c.url === videoPlayer.src);
        const next = diff > 0 ? index - 1 : index + 1;
        if (channels[next]) playChannel(channels[next]);
      }
    });

    fetchM3U();
  </script></body>
</html>
