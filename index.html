<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPTV PREMIUM</title>
  <link rel="icon" href="logo.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #121212;
      color: white;
      font-family: 'Segoe UI', sans-serif;
    }
    .app-header {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background-color: #1f1f1f;
      position: sticky;
      top: 0;
      z-index: 999;
      border-bottom: 1px solid #333;
    }
    .app-header img {
      height: 30px;
      margin-right: 10px;
    }
    .app-header strong {
      font-size: 1.25rem;
    }
    .theme-toggle {
      margin-left: auto;
      cursor: pointer;
    }
    .video-player {
      width: 100%;
      height: 250px;
      background: black;
    }
    .now-playing {
      background: #222;
      padding: 8px 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #333;
    }
    .now-playing img {
      height: 24px;
      margin-right: 8px;
    }
    .channel-list {
      display: flex;
      overflow-x: auto;
      padding: 10px;
      gap: 10px;
    }
    .channel-item {
      background: #1f1f1f;
      padding: 10px;
      border-radius: 8px;
      min-width: 150px;
      cursor: pointer;
    }
    .channel-item:hover {
      background: #333;
    }
    .controls {
      padding: 10px;
    }
    .favorites-filter {
      cursor: pointer;
      margin-left: 10px;
    }
  </style>
</head>
<body>

  <div class="app-header">
    <img src="logo.png" alt="Logo">
    <strong>IPTV PREMIUM</strong>
    <span class="material-icons theme-toggle" onclick="toggleTheme()">brightness_6</span>
  </div>

  <div class="video-player" id="videoPlayer">
    <video id="player" controls autoplay></video>
  </div>

  <div class="now-playing" id="nowPlaying">
    <img src="logo.png" alt="Channel Icon">
    <span id="nowPlayingTitle">Now Playing</span>
  </div>

  <div class="controls">
    <input type="text" id="searchInput" class="form-control mb-2" placeholder="Search channels...">
    <select id="categoryFilter" class="form-select">
      <option value="all">All Categories</option>
    </select>
  </div>

  <div class="channel-list" id="channelList"></div>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u";
    let channels = [];
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

    async function loadM3U() {
      const res = await fetch(m3uUrl);
      const text = await res.text();
      const lines = text.split('\n');
      let temp = {};
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        if (line.startsWith('#EXTINF')) {
          const nameMatch = line.match(/,(.*)$/);
          const groupMatch = line.match(/group-title="(.*?)"/);
          const logoMatch = line.match(/tvg-logo="(.*?)"/);
          temp = {
            name: nameMatch ? nameMatch[1] : 'Unknown',
            group: groupMatch ? groupMatch[1] : 'Other',
            logo: logoMatch ? logoMatch[1] : 'logo.png',
            url: lines[i + 1]
          };
        } else if (line.startsWith('http') && temp.name) {
          channels.push(temp);
          temp = {};
        }
      }
      populateCategories();
      renderChannels();
    }

    function populateCategories() {
      const select = document.getElementById('categoryFilter');
      const groups = [...new Set(channels.map(c => c.group))];
      groups.forEach(g => {
        const opt = document.createElement('option');
        opt.value = g;
        opt.textContent = g;
        select.appendChild(opt);
      });
    }

    function renderChannels(filter = '') {
      const list = document.getElementById('channelList');
      const category = document.getElementById('categoryFilter').value;
      list.innerHTML = '';
      channels.filter(c =>
        (category === 'all' || c.group === category) &&
        (c.name.toLowerCase().includes(filter.toLowerCase()))
      ).forEach(channel => {
        const div = document.createElement('div');
        div.className = 'channel-item';
        div.innerHTML = `<strong>${channel.name}</strong><br/><small>${channel.group}</small>`;
        div.onclick = () => playChannel(channel);
        list.appendChild(div);
      });
    }

    function playChannel(channel) {
      const player = document.getElementById('player');
      const nowTitle = document.getElementById('nowPlayingTitle');
      const nowImg = document.querySelector('#nowPlaying img');
      player.src = channel.url;
      nowTitle.textContent = channel.name;
      nowImg.src = channel.logo;
    }

    function toggleTheme() {
      document.body.classList.toggle('light');
    }

    document.getElementById('searchInput').addEventListener('input', e => {
      renderChannels(e.target.value);
    });

    document.getElementById('categoryFilter').addEventListener('change', () => {
      renderChannels(document.getElementById('searchInput').value);
    });

    window.onload = loadM3U;
  </script>
</body>
</html>
