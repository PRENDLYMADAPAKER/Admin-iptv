<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Premium</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
    }
    header {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #1e1e1e;
    }
    header img {
      height: 40px;
      margin-right: 10px;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    #videoPlayer {
      width: 100%;
      height: 360px;
      background: black;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #controls {
      padding: 10px;
    }
    #channelList {
      display: flex;
      flex-wrap: wrap;
    }
    .channel {
      width: 120px;
      margin: 10px;
      cursor: pointer;
      text-align: center;
    }
    .channel img {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
    }
    #categoryFilter, #searchBar, #sortSelect {
      margin: 10px;
    }
    #miniPlayer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 200px;
      height: 112px;
      z-index: 20;
      display: none;
    }
    .dark-mode {
      background-color: #121212;
      color: white;
    }
    .light-mode {
      background-color: #ffffff;
      color: black;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>IPTV Premium</h1>
    <button onclick="toggleTheme()">ðŸŒ“</button>
  </header>
  <video id="videoPlayer" controls autoplay></video>
  <div id="controls">
    <select id="categoryFilter"></select>
    <input type="text" id="searchBar" placeholder="Search channels...">
    <select id="sortSelect">
      <option value="az">A-Z</option>
      <option value="group">Category</option>
    </select>
  </div>
  <div id="channelList"></div>
  <div id="miniPlayer"></div>
  <script>
    const videoPlayer = document.getElementById('videoPlayer');
    const miniPlayer = document.getElementById('miniPlayer');
    const searchBar = document.getElementById('searchBar');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortSelect = document.getElementById('sortSelect');
    const channelList = document.getElementById('channelList');let channels = [];
let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
let lastChannel = localStorage.getItem('lastChannel');

function fetchM3U() {
  fetch('https://raw.githubusercontent.com/PRENDLYMADAPAKER/ANG-KALAT-MO/main/IPTVPREMIUM.m3u')
    .then(res => res.text())
    .then(parseM3U);
}

function parseM3U(data) {
  const lines = data.split('\n');
  let group = '', logo = '', name = '', url = '';
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].startsWith('#EXTINF')) {
      const info = lines[i];
      const match = info.match(/tvg-logo="(.*?)".*?group-title="(.*?)".*?,(.*)/);
      if (match) {
        logo = match[1];
        group = match[2];
        name = match[3];
        url = lines[i + 1];
        channels.push({ name, group, logo, url });
      }
    }
  }
  updateUI();
}

function updateUI() {
  channelList.innerHTML = '';
  const search = searchBar.value.toLowerCase();
  const selectedGroup = categoryFilter.value;
  const sorted = [...channels].sort((a, b) => a.name.localeCompare(b.name));

  const groups = [...new Set(channels.map(ch => ch.group))];
  categoryFilter.innerHTML = `<option value="">All</option>` +
    groups.map(g => `<option value="${g}">${g}</option>`).join('');

  sorted.forEach(ch => {
    if ((selectedGroup && ch.group !== selectedGroup) ||
        (search && !ch.name.toLowerCase().includes(search))) return;
    const div = document.createElement('div');
    div.className = 'channel';
    div.innerHTML = `<img src="${ch.logo}" onerror="this.src='default.jpg'"/><br>${ch.name}`;
    div.onclick = () => playChannel(ch);
    channelList.appendChild(div);
  });
}

function playChannel(ch) {
  videoPlayer.src = ch.url;
  localStorage.setItem('lastChannel', ch.url);
}

function toggleTheme() {
  document.body.classList.toggle('dark-mode');
  document.body.classList.toggle('light-mode');
}

searchBar.oninput = updateUI;
categoryFilter.onchange = updateUI;
sortSelect.onchange = updateUI;

document.addEventListener('scroll', () => {
  if (window.scrollY > 200) {
    miniPlayer.innerHTML = videoPlayer.outerHTML;
    miniPlayer.style.display = 'block';
  } else {
    miniPlayer.innerHTML = '';
    miniPlayer.style.display = 'none';
  }
});

document.addEventListener('keydown', (e) => {
  const currentIndex = channels.findIndex(ch => ch.url === videoPlayer.src);
  if (e.key === 'ArrowRight' && currentIndex < channels.length - 1) playChannel(channels[currentIndex + 1]);
  if (e.key === 'ArrowLeft' && currentIndex > 0) playChannel(channels[currentIndex - 1]);
});

if (lastChannel) videoPlayer.src = lastChannel;
fetchM3U();

  </script>
</body>
</html>
